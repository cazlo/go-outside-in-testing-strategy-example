services:
  wiremock:
    image: wiremock/wiremock:3.9.1
    ports:
      - "8081:8080"
    command: ["--verbose"]
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:8080/__admin"]
      interval: 5s
      timeout: 2s
      retries: 20

  # Optional: run the app in Docker (CI-like)
  app:
    build:
      context: .
      target: prod
    environment:
      ADDR: ":8080"
      # point to wiremock to simulate "external dependency"
      EXTERNAL_URL: "http://wiremock:8080/status/204"
    ports:
      - "8080:8080"
    depends_on:
      wiremock:
        condition: service_healthy
